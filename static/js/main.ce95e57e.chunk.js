(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{163:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(8),c=a.n(o),s=(a(73),a(19)),l=a(11),i=a(14),u=a(29),m=a(97),d=a(98),p=a(12),f="LOGIN_SUCCESS",h="REGISTER_SUCCESS",b="USER_LOADED",g="AUTH_ERROR",E="LOG_OUT",v={token:null,isAuthenticated:!1,loading:!0,user:null},O=Object(u.combineReducers)({auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case h:case f:return Object(p.a)(Object(p.a)({},e),{},{token:t.payload.token,isAuthenticated:t.payload.isAuthenticated,loading:t.payload.loading});case E:case g:return Object(p.a)(Object(p.a)({},e),{},{token:t.payload.token,isAuthenticated:t.payload.isAuthenticated,loading:t.payload.loading,user:t.payload.user});case b:return Object(p.a)(Object(p.a)({},e),{},{isAuthenticated:t.payload.isAuthenticated,loading:t.payload.loading,user:t.payload.user});default:return Object(p.a)({},e)}}}),j=[d.a],w=Object(u.createStore)(O,{},Object(m.composeWithDevTools)(u.applyMiddleware.apply(void 0,j))),k=a(194),S=a(197),y=a(199),N=a(200),x=a(202),C=a(28),A=a.n(C),I=a(46),R=a(99),D=a.n(R).a.create({baseURL:"https://chat-cocket.herokuapp.com"});D.defaults.headers["Content-Type"]="application/json",localStorage.token?D.defaults.headers["auth-token"]=localStorage.token:delete D.defaults.headers["auth-token"],console.log(D.defaults.headers);var P=D;var L={loginSuccess:function(e){return{type:f,payload:{token:e,isAuthenticated:!0,loading:!1}}},registerSuccess:function(e){return{type:h,payload:{token:e,isAuthenticated:!0,loading:!1}}},loadUserSuccess:function(e){return{type:b,payload:{isAuthenticated:!0,loading:!1,user:e}}},logoutSuccess:function(){return{type:E,payload:{token:null,isAuthenticated:!1,loading:!1,user:null}}},authError:function(){return{type:g,payload:{token:null,isAuthenticated:!1,loading:!1,user:null}}}},T=function(e){e?P.defaults.headers["auth-token"]=e:delete P.defaults.headers["auth-token"]},U=Object(k.a)((function(e){return{root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}}})),_=function(){var e=U(),t=Object(i.b)(),a=Object(i.c)((function(e){return e.auth.isAuthenticated}));return r.a.createElement("div",{className:e.root},r.a.createElement(S.a,{position:"static"},r.a.createElement(y.a,null,r.a.createElement(N.a,{variant:"h6",className:e.title},r.a.createElement(s.b,{to:"/"},r.a.createElement("span",{className:"nav-link"},"Pet Chat"))),a?r.a.createElement(r.a.Fragment,null,r.a.createElement(s.b,{to:"/"},r.a.createElement(x.a,{variant:"contained",className:"button-margins",onClick:function(){t(function(){var e=Object(I.a)(A.a.mark((function e(t){var a,n,r;return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{localStorage.removeItem("token"),t(L.logoutSuccess())}catch(o){(r=(null===(a=o.response)||void 0===a||null===(n=a.data)||void 0===n?void 0:n.errors)||[{message:"Server error"}])&&r.forEach((function(e){console.error(e)})),localStorage.removeItem("token"),t(L.authError())}case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},"Logout"))):r.a.createElement(s.b,{to:"/login"},r.a.createElement(x.a,{variant:"contained",className:"button-margins"},"Login")))))},F=a(30),G=a(27),M=a(201),J=Object(k.a)((function(e){return{root:{"& > *":{margin:e.spacing(1),width:"25ch"}}}})),B=function(){var e=Object(i.b)(),t=J(),a=Object(i.c)((function(e){return e.auth.isAuthenticated})),o=Object(n.useState)({email:"",password:""}),c=Object(G.a)(o,2),u=c[0],m=c[1],d=function(e){m(Object(p.a)(Object(p.a)({},u),{},Object(F.a)({},e.target.name,e.target.value)))};return a?r.a.createElement(l.a,{to:"/"}):r.a.createElement("section",{className:"container"},r.a.createElement("h1",{className:"center"},"Login"),r.a.createElement("form",{className:"".concat(t.root," center"),noValidate:!0,autoComplete:"off",onSubmit:function(t){t.preventDefault(),e(function(e){var t=e.email,a=e.password;return function(){var e=Object(I.a)(A.a.mark((function e(n){var r,o,c,s,l;return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=JSON.stringify({email:t,password:a}),e.prev=1,e.next=4,P.post("/api/auth/login",r);case 4:o=e.sent,console.log(o.data.token),localStorage.setItem("token",o.data.token),T(o.data.token),n(L.loginSuccess(o.data.token)),e.next=17;break;case 11:e.prev=11,e.t0=e.catch(1),(l=(null===(c=e.t0.response)||void 0===c||null===(s=c.data)||void 0===s?void 0:s.errors)||[{message:"Server error"}])&&l.forEach((function(e){console.error(e)})),localStorage.removeItem("token"),n(L.authError());case 17:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t){return e.apply(this,arguments)}}()}(u)),m({email:"",password:""})}},r.a.createElement(M.a,{id:"standard-basic",label:"Email",value:u.email,name:"email",onChange:d}),r.a.createElement(M.a,{id:"standard-basic",label:"Password",type:"password",value:u.password,name:"password",onChange:d}),r.a.createElement(s.b,{to:"/register"},"Do not have an account?"),r.a.createElement(x.a,{variant:"contained",color:"primary",type:"submit"},"Submit")))},V=Object(k.a)((function(e){return{root:{"& > *":{margin:e.spacing(1),width:"25ch"}}}})),W=function(){var e=Object(i.b)(),t=V(),a=Object(i.c)((function(e){return e.auth.isAuthenticated})),o=Object(n.useState)({email:"",username:"",password:"",confirmPassword:""}),c=Object(G.a)(o,2),u=c[0],m=c[1],d=!(u.password===u.confirmPassword),f=function(e){m(Object(p.a)(Object(p.a)({},u),{},Object(F.a)({},e.target.name,e.target.value)))};return a?r.a.createElement(l.a,{to:"/"}):r.a.createElement("section",{className:"container"},r.a.createElement("h1",{className:"center"},"Register"),r.a.createElement("form",{className:"".concat(t.root," center"),noValidate:!0,autoComplete:"off",onSubmit:function(t){t.preventDefault(),u.password===u.confirmPassword&&m({email:"",password:"",confirmPassword:"",username:""}),e(function(e){var t=e.email,a=e.password,n=e.username;return function(){var e=Object(I.a)(A.a.mark((function e(r){var o,c,s,l,i;return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=JSON.stringify({email:t,password:a,username:n}),e.prev=1,e.next=4,P.post("/api/auth/register",o);case 4:c=e.sent,localStorage.setItem("token",c.data.token),T(c.data.token),r(L.registerSuccess(c.data.token)),e.next=16;break;case 10:e.prev=10,e.t0=e.catch(1),(i=(null===(s=e.t0.response)||void 0===s||null===(l=s.data)||void 0===l?void 0:l.errors)||[{message:"Server error"}])&&i.forEach((function(e){console.error(e)})),localStorage.removeItem("token"),r(L.authError());case 16:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}()}(u))}},r.a.createElement(M.a,{id:"standard-basic",label:"Email",value:u.email,name:"email",onChange:f}),r.a.createElement(M.a,{id:"standard-basic",label:"Name",value:u.username,name:"username",onChange:f}),r.a.createElement(M.a,{error:d,id:d?"standard-error-helper-text":"standard-basic",helperText:d&&"password didn`t match",label:"Password",type:"password",value:u.password,name:"password",onChange:f}),r.a.createElement(M.a,{error:d,id:d?"standard-error-helper-text":"standard-basic",helperText:d&&"password didn`t match",label:"Confirm password",type:"password",value:u.confirmPassword,name:"confirmPassword",onChange:f}),r.a.createElement(s.b,{to:"/login"},"Already have an account?"),r.a.createElement(x.a,{variant:"contained",color:"primary",type:"submit"},"Submit")))},H=a(47),X=a(100),q=a.n(X)()("https://chat-cocket.herokuapp.com"),z=Object(k.a)((function(e){return{root:{"& > *":{margin:e.spacing(1),width:"25ch"}}}})),K=function(e){var t=e.socket,a=e.user,o=e.onExitRoom,c=z(),s=Object(n.useState)({user:a,roomId:"",password:""}),l=Object(G.a)(s,2),i=l[0],u=l[1],m=function(e){u(Object(p.a)(Object(p.a)({},i),{},Object(F.a)({},e.target.name,e.target.value)))};return r.a.createElement("div",null,r.a.createElement("h1",{className:"center"},"Connect to room"),r.a.createElement("form",{className:"".concat(c.root," center"),noValidate:!0,autoComplete:"off",onSubmit:function(e){e.preventDefault(),o(),t.emit("JOIN:ROOM",i),u(Object(p.a)(Object(p.a)({},i),{},{roomId:"",password:""}))},onReset:function(e){e.preventDefault(),o(),t.emit("EXIT:ROOM"),u(Object(p.a)(Object(p.a)({},i),{},{roomId:"",password:""}))}},r.a.createElement(M.a,{id:"standard-basic",label:"Room Name",name:"roomId",onChange:m,value:i.roomId}),r.a.createElement(M.a,{id:"standard-basic",label:"Password",name:"password",onChange:m,value:i.password}),r.a.createElement(x.a,{variant:"contained",color:"primary",type:"submit"},"Enter room"),r.a.createElement(x.a,{variant:"contained",color:"primary",type:"reset"},"Exit room")))},Q=function(){var e=Object(n.useState)([]),t=Object(G.a)(e,2),a=t[0],o=t[1],c=Object(n.useState)(""),s=Object(G.a)(c,2),l=s[0],u=s[1],m=Object(i.c)((function(e){return e.auth.user}));Object(n.useEffect)((function(){return function(){q.close()}}),[]),q.on("message",(function(e){o([].concat(Object(H.a)(a),[{username:e.username,text:e.text,date:new Date}]))})),q.on("PREW:MSG",(function(e){o([].concat(Object(H.a)(a),Object(H.a)(e)))}));return r.a.createElement("section",{className:"chat-container"},r.a.createElement(K,{socket:q,user:m,onExitRoom:function(){o([])}}),r.a.createElement("div",{className:"chat"},r.a.createElement("div",{className:"message-container"},a.length?a.map((function(e){var t=new Date(e.date).toLocaleString("ru-RU",{hour12:!1});return r.a.createElement(r.a.Fragment,null,m.username===e.username?r.a.createElement("div",{className:"message",key:e.message_id||Date.now()},r.a.createElement("span",null,r.a.createElement("strong",null,e.username),": ",e.text),r.a.createElement("span",{className:"message-date"},t)):r.a.createElement("div",{className:"message inbox",key:e.message_id||Date.now()},r.a.createElement("span",null,e.text,": ",r.a.createElement("strong",null,e.username)),r.a.createElement("span",{className:"message-date"},t)))})):null),r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),l&&(o([].concat(Object(H.a)(a),[{username:m.username,text:l,date:new Date}])),q.emit("message",l),u(""))},className:"chat-form"},r.a.createElement(M.a,{id:"standard-basic",value:l,name:"message",onChange:function(e){u(e.target.value)},className:"message-input"}),r.a.createElement(x.a,{variant:"contained",color:"primary",type:"submit",className:"send-button"},"Send"))))},Y=function(){var e=Object(i.b)(),t=Object(i.c)((function(e){return e.auth.isAuthenticated}));return Object(n.useEffect)((function(){localStorage.getItem("token")&&e(function(){var e=Object(I.a)(A.a.mark((function e(t){var a,n,r,o;return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,P.get("/api/auth/user");case 3:a=e.sent,t(L.loadUserSuccess(a.data)),e.next=12;break;case 7:e.prev=7,e.t0=e.catch(0),(o=(null===(n=e.t0.response)||void 0===n||null===(r=n.data)||void 0===r?void 0:r.errors)||[{message:"Server error"}])&&o.forEach((function(e){console.error(e)})),t(L.authError());case 12:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}())}),[]),t?r.a.createElement(Q,null):r.a.createElement("h1",null,"Main page")},Z=function(){return Object(n.useEffect)((function(){localStorage.getItem("token")}),[]),r.a.createElement(i.a,{store:w},r.a.createElement(s.a,null,r.a.createElement(_,null),r.a.createElement(l.d,null,r.a.createElement(l.b,{exact:!0,path:"/"},r.a.createElement(Y,null)),r.a.createElement(l.b,{exact:!0,path:"/login"},r.a.createElement(B,null)),r.a.createElement(l.b,{exact:!0,path:"/register"},r.a.createElement(W,null)))))},$=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,204)).then((function(t){var a=t.getCLS,n=t.getFID,r=t.getFCP,o=t.getLCP,c=t.getTTFB;a(e),n(e),r(e),o(e),c(e)}))};c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(Z,null)),document.getElementById("root")),$()},73:function(e,t,a){}},[[163,1,2]]]);
//# sourceMappingURL=main.ce95e57e.chunk.js.map